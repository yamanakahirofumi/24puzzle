# 画像読み込みに関する仕様

本ドキュメントでは、24-Puzzle における画像ファイルの読み込み、加工、およびパズル盤面への適用に関する詳細な仕様を定義します。

## 1. サポートする画像形式

以下の標準的な画像フォーマットの読み込みをサポートします。

- **PNG** (.png)
- **JPEG** (.jpg, .jpeg)
- **GIF** (.gif)
    - ※ アニメーションGIFは、アニメーションを維持したまま分割表示します。

## 2. 画像の加工処理

読み込まれた画像は、5x5のパズルに最適化するために以下の手順で自動的に加工されます。

### 2.1 スクエアクロップ（切り抜き）
パズル盤面が正方形（5x5）であるため、読み込んだ画像のアスペクト比が 1:1 でない場合は、画像の中央部分を基準に正方形に切り抜きます。

- **横長画像の場合**: 左右の両端を均等にカットし、中央の正方形部分を残します。
- **縦長画像の場合**: 上下の両端を均等にカットし、中央の正方形部分を残します。

### 2.2 リサイズ
クロップされた画像は、パズル表示エリアのサイズに合わせてスケーリングされます。内部的な処理の詳細は[実装詳細](../tech/Implementation-Details.md)を参照してください。

## 3. パズル盤面への分割・割り当て

加工された1枚の正方形画像は、以下のルールに従って分割・配置されます。

- **分割数**: 垂直・水平方向にそれぞれ5等分し、計25枚のパネル用画像を生成します。
- **配置**: 分割された各画像は、左上から右下に向けて順番に各パネルへ割り当てられます。
- **空きマスの扱い**: 右下隅（25番目）に相当する画像部分は使用されず、この位置は「空きマス」として表示されます。
- **数字の重畳**: 画像パズルモードでは、分割された画像の上に正解位置を示す数字を表示できます。詳細は[数字の仕様](Number-Specification.md)を参照してください。

## 4. 完成図のプレビュー表示

画像を読み込んだ際、パズルの目標状態を確認するためのプレビュー機能を提供します。

- **表示場所**: コントロールパネル内の指定エリア。
- **表示内容**: クロップおよびリサイズ処理が行われた後の「完成図」の全体像。
- **表示タイミング**: 画像の読み込み完了後、常時表示（またはボタン操作等によるポップアップ表示）。
- **役割**:
    - 読み込んだ画像がどのようにクロップされたかの確認。
    - ゲームプレイ中のカンニングペーパー（目標状態のガイド）としての利用。

## 5. 操作手順とエラーハンドリング

### 4.1 読み込みの手順
1. コントロールパネルの「画像選択」ボタンを押下します。
2. ファイル選択ダイアログが表示されるので、任意の画像ファイルを選択します。
3. 選択が完了すると、即座に盤面に反映され、パズルが「完成状態」で表示されます。同時に、コントロールパネルに「完成図のプレビュー」が表示されます。
4. 「開始」ボタンを押すことで、その画像を用いたゲームがスタートします。

### 4.2 エラーハンドリング
以下のようなケースでは、ユーザーに対して適切なエラーメッセージを表示します。

- **非対応のファイル形式**: サポート外の拡張子や、破損した画像ファイルを選択した場合。
- **読み込み失敗**: ファイルへのアクセス権限がない場合や、読み込み中に予期せぬエラーが発生した場合。
- **メモリ制限**: 極端に巨大な解像度の画像を読み込もうとした場合。

エラー発生時は、現在の画像（またはデフォルトの状態）が維持され、ゲームの進行が妨げられないように制御します。
